
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html class="theme">
<head>
    <meta charset="utf-8">
    
    <meta name="description" content="A simple, intelligent and flexible HTTP client for Android. With LiteHttp you can make HTTP request with only one line of code! It supports get, post, put, delete, head, trace, options and patch request types.">
    <meta name="author" content="马天宇">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <title>LiteHttp - Get Start</title>

    <link href="../../css/base.lib.min.css" rel="stylesheet" media="screen">  
    <!-- id="prettify-style will be used to get the link element below and change href to change prettify code style" -->
    <link id="prettify-style" href="../../css/prettify-cmd.css" type="text/css" rel="stylesheet">
    <link href="../../css/layout.min.css" rel="stylesheet" media="screen">

</head>

<body class="theme">

<div id="editor-reader-full" class="editor-reader-full-shown" style="position: static;">
    <div id="reader-full-topInfo" class="reader-full-topInfo-shown">
        <span>
            <code>@litesuits</code>
        </span>
        <code><span id="article-updated-date">2014-03-13 02:41</span></code>
    </div>
    <div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><h1 id="litehttp">LiteHttp 引言</h1>

<p>我们来看一个普通android网络应用上，最基础的http连接和json解析方式，一个简单例子，从服务器获取id=168的用户的信息，User的json结构：</p>

<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="language-json"><span class="pun">{</span></code></li><li class="L1"><code class="language-json"><span class="pln">    </span><span class="str">"api"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"com.xx.get.userinfo"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-json"><span class="pln">    </span><span class="str">"v"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1.0"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-json"><span class="pln">    </span><span class="str">"result"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-json"><span class="pln">        </span><span class="str">"code"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">200</span><span class="pun">,</span></code></li><li class="L5"><code class="language-json"><span class="pln">        </span><span class="str">"message"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"success"</span></code></li><li class="L6"><code class="language-json"><span class="pln">    </span><span class="pun">},</span></code></li><li class="L7"><code class="language-json"><span class="pln">    </span><span class="str">"data"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-json"><span class="pln">        </span><span class="str">"age"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">18</span><span class="pun">,</span></code></li><li class="L9"><code class="language-json"><span class="pln">        </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"qingtianzhu"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-json"><span class="pln">        </span><span class="str">"girl_friends"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L1"><code class="language-json"><span class="pln">            </span><span class="str">"xiaoli"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-json"><span class="pln">            </span><span class="str">"fengjie"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-json"><span class="pln">            </span><span class="str">"lucy"</span></code></li><li class="L4"><code class="language-json"><span class="pln">        </span><span class="pun">]</span></code></li><li class="L5"><code class="language-json"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code class="language-json"><span class="pun">}</span></code></li></ol></pre>

<p>api, v, result为基础信息，完成这个任务一般分三步： </p>
<p>1. 组织api的url地址和参数（这个很简单），比如：</p>

<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">String</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> </span><span class="str">"http://litesuits.github.io/mockdata/user?userid=168"</span><span class="pun">;</span></code></li></ol></pre>

<p>2. http连接网络获取api信息（这个通过封装后还算简单），典型代码：</p>

<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="language-java"><span class="com">/**</span></code></li><li class="L1"><code class="language-java"><span class="com"> * 关闭流顺序：先打开的后关闭；被依赖的后关闭。</span></code></li><li class="L2"><code class="language-java"><span class="com"> * @return string info</span></code></li><li class="L3"><code class="language-java"><span class="com"> */</span></code></li><li class="L4"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> sendHttpRequst</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> apiUrl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="typ">HttpURLConnection</span><span class="pln"> conn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="typ">InputStream</span><span class="pln"> is </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span class="typ">ByteArrayOutputStream</span><span class="pln"> baos </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-java"><span class="pln">        URL url </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> URL</span><span class="pun">(</span><span class="pln">apiUrl</span><span class="pun">);</span></code></li><li class="L0"><code class="language-java"><span class="pln">        conn </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">HttpURLConnection</span><span class="pun">)</span><span class="pln"> url</span><span class="pun">.</span><span class="pln">openConnection</span><span class="pun">();</span></code></li><li class="L1"><code class="language-java"><span class="pln">        conn</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">();</span></code></li><li class="L2"><code class="language-java"><span class="pln">        is </span><span class="pun">=</span><span class="pln"> conn</span><span class="pun">.</span><span class="pln">getInputStream</span><span class="pun">();</span></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="kwd">int</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> conn</span><span class="pun">.</span><span class="pln">getContentLength</span><span class="pun">();</span></code></li><li class="L4"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">len </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="pln">        baos </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ByteArrayOutputStream</span><span class="pun">(</span><span class="pln">len</span><span class="pun">);</span></code></li><li class="L6"><code class="language-java"><span class="pln">        </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> buffer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="lit">1024</span><span class="pun">];</span></code></li><li class="L7"><code class="language-java"><span class="pln">        len </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L8"><code class="language-java"><span class="pln">        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">((</span><span class="pln">len </span><span class="pun">=</span><span class="pln"> is</span><span class="pun">.</span><span class="pln">read</span><span class="pun">(</span><span class="pln">buffer</span><span class="pun">))</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-java"><span class="pln">            baos</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="pln">buffer</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> len</span><span class="pun">);</span></code></li><li class="L0"><code class="language-java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="language-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> baos</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">();</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MalformedURLException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-java"><span class="pln">        e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-java"><span class="pln">        e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-java"><span class="pln">        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">baos </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> baos</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span></code></li><li class="L9"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">is </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> is</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span></code></li><li class="L0"><code class="language-java"><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">            e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L2"><code class="language-java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">conn </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> conn</span><span class="pun">.</span><span class="pln">disconnect</span><span class="pun">();</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pun">}</span></code></li></ol></pre>

<p>3. 解析服务器反馈的string（这是很头疼的）：</p>

<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> parseJsonToUser</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> json</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="typ">User</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">();</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">json </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-java"><span class="pln">            </span><span class="typ">JSONObject</span><span class="pln"> jsonObj </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JSONObject</span><span class="pun">(</span><span class="pln">json</span><span class="pun">);</span></code></li><li class="L5"><code class="language-java"><span class="pln">            </span><span class="typ">JSONObject</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> jsonObj</span><span class="pun">.</span><span class="pln">optJSONObject</span><span class="pun">(</span><span class="str">"result"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-java"><span class="pln">            </span><span class="typ">JSONObject</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> jsonObj</span><span class="pun">.</span><span class="pln">optJSONObject</span><span class="pun">(</span><span class="str">"data"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-java"><span class="pln">            </span><span class="typ">JSONArray</span><span class="pln"> arr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L8"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> arr </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">optJSONArray</span><span class="pun">(</span><span class="str">"girl_friends"</span><span class="pun">);</span></code></li><li class="L9"><code class="language-java"></code></li><li class="L0"><code class="language-java"><span class="pln">            user</span><span class="pun">.</span><span class="pln">result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="typ">Result</span><span class="pun">();</span></code></li><li class="L1"><code class="language-java"><span class="pln">            user</span><span class="pun">.</span><span class="pln">data </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="typ">UserInfo</span><span class="pun">();</span></code></li><li class="L2"><code class="language-java"><span class="pln">            user</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">girl_friends </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;();</span></code></li><li class="L3"><code class="language-java"></code></li><li class="L4"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">jsonObj </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-java"><span class="pln">                user</span><span class="pun">.</span><span class="pln">api </span><span class="pun">=</span><span class="pln"> jsonObj</span><span class="pun">.</span><span class="pln">optString</span><span class="pun">(</span><span class="str">"api"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-java"><span class="pln">                user</span><span class="pun">.</span><span class="pln">v </span><span class="pun">=</span><span class="pln"> jsonObj</span><span class="pun">.</span><span class="pln">optString</span><span class="pun">(</span><span class="str">"v"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-java"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L8"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-java"><span class="pln">                user</span><span class="pun">.</span><span class="pln">result</span><span class="pun">.</span><span class="pln">code </span><span class="pun">=</span><span class="pln"> result</span><span class="pun">.</span><span class="pln">optInt</span><span class="pun">(</span><span class="str">"code"</span><span class="pun">);</span></code></li><li class="L0"><code class="language-java"><span class="pln">                user</span><span class="pun">.</span><span class="pln">result</span><span class="pun">.</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> result</span><span class="pun">.</span><span class="pln">optString</span><span class="pun">(</span><span class="str">"message"</span><span class="pun">);</span></code></li><li class="L1"><code class="language-java"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-java"><span class="pln">                user</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">age </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">optInt</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">);</span></code></li><li class="L4"><code class="language-java"><span class="pln">                user</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">optString</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">);</span></code></li><li class="L5"><code class="language-java"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L6"><code class="language-java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">arr </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-java"><span class="pln">                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> size </span><span class="pun">=</span><span class="pln"> arr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">();</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> size</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-java"><span class="pln">                    user</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">girl_friends</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">arr</span><span class="pun">.</span><span class="pln">optString</span><span class="pun">(</span><span class="pln">i</span><span class="pun">));</span></code></li><li class="L9"><code class="language-java"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code class="language-java"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1"><code class="language-java"><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">JSONException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-java"><span class="pln">            e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> user</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pun">}</span></code></li></ol></pre>

<p>那么我们看到第3步在User这个类仅仅有3个属性的情况下，就写了约40行代码，如果User有几十个属性，应用中又有几十个类型User的Model，那么代码量将会指数级暴增，这种方式相对会耗费较大的劳动力。 <br>
<p>那么，就此转入正题，看看LiteHttp是怎么完成这个任务的：</p>
</p>

<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">User</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span></code></li></ol></pre>
<br>
<p>Github地址：<a href="https://github.com/litesuits/android-lite-http" target="_blank">https://github.com/litesuits/android-lite-http</a></p>
<p>项目中有20几个使用案例(Samples)，应该足够你起步啦！</p>
</div>
</div>

</body>
</html>
    
